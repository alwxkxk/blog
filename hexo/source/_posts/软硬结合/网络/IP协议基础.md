---
title: IP协议基础
toc: true
abbrlink: 37286
date: 2018-10-11 19:26:41
tags:
---

&emsp;网上快速阅读所获得的知识只是轮廓，要看清知识的面目就要啃书：《计算机网络》。
![TCP/IP协议模型](http://ww1.sinaimg.cn/large/005BIQVbgy1fvi66culs3j30if0d674z.jpg)
&emsp;IP协议（Internet Protocol 网际协议）属于第二层网络层，在讨论它之前还得先简单介绍第一层链路层。

# 链路层
- 链路(物理链路)：从一个结点到相邻结点的一段物理线路，而中间没有任何其他的交换结点。
- 数据链路(逻辑链路)：把实现通信协议的硬件和软件加到链路上，就构成了数据链路。现在最常用的方法是网络适配器来实现这些协议和软件。一般的适配器都包括了数据链路层和物理层这两层的功能。
- 帧：数据链路层的协议数据单元。

&emsp;数据链路层把网络层交下来的数据构成帧发送到链路上，以及把接收到的帧中的数据去除并交给网络层。
![《计算机网络》-数据链路层](http://ww1.sinaimg.cn/large/005BIQVbgy1fw4jh07kotj30f704vdg5.jpg)

&emsp;点对点信道的数据链路层在进行通信时的主要步骤如下：
1. 结点A的数据链路层把网络层交下来的IP数据报添加到首部和尾部封装成帧。
2. 结点A把封装好的帧发送给结点B的数据链路层。
3. 若结点B的数据链路层收到的帧无差错，则从收到的帧中提取出IP数据报上交给上面的网络层，否则就丢弃这个帧。

## 数据封装
&emsp;链路层在接收网络层的数据时，会进行封装（encapsulation）。

# IP协议

## 外网IP与内网IP
&emsp;首先看看常见的网络类型：
![外网IP与内网IP](http://ww1.sinaimg.cn/large/005BIQVbgy1fuoemhdd56j30rr0iwjs6.jpg)
&emsp;想一下我们电脑怎么连接上网的。喊电信移动给家里装宽带，工作人员就会给你家里安装一台拨号器与路由器，路由器与拨号器相连，电脑与路由器相连。公司也一样，不过是电脑多一些，可能会有几台路由器，而这些路由器最终都会连接到拨号器。对应上图的C类。

场景|是否接入互联网|是否向外提供服务|例子
---|---|---|---
A类|√|√|提供网页服务的云服务器
B类|×|×|公安局用于存放敏感数据的服务器
C类|√|×|企业网络、家庭网络


&emsp;由于接入网络的电脑数量超出了设计者的设想，IPv4的地址并不够用，随时有超出的可能，所以提出了很多解决方案，除了IPv6（号称给地球所有东西都能分配一个独立的IP地址）之外，还有划分子网的方案，并让IPv4一直续命至今。现在IP地址不够用了，于是设计者把一部分IP地址列为私有IP，让处于内网的电脑使用私有IP，对外的使用公有IP。如上图所示，按旧的做法，所有接入互联网的电脑，都需要一个IP地址，A类一台电脑1个，C类三台电脑3个，共需要4个公有IP地址。划分子网后，A类电脑占用1个公有IP地址，C类三台电脑共使用1个公有IP地址，子网里使用3个私有IP来相互区分。  __公有IP代表全球独一无二的IP地址，不可重复。而私有IP代表内网地址，只需要内网里保证独一无二即可。__ 

&emsp;A类电脑需要向外提供服务，所以IP地址需要固定不变。而C类电脑并不需要向外提供服务，所以运营商会给这些电脑的调解网关动态分配IP地址就可以了，当这些电脑不用时，可以把这个IP地址再分配给别人。

&emsp;被列入私有IP地址是：
- 10.0.0.0        -   10.255.255.255  (10/8 prefix)
- 172.16.0.0      -   172.31.255.255  (172.16/12 prefix)
- 192.168.0.0     -   192.168.255.255 (192.168/16 prefix)

&emsp;另外一下，有一个IP地址很特别而且经常用到：127.0.0.1 代表本机IP地址。

## 查看IP地址
- 查看本机内网IP 
打开命令提示符（win+R 输入cmd，或在菜单里输入cmd搜索）,输入ipconfig。
![打开cmd](http://ww1.sinaimg.cn/large/005BIQVbgy1fupe1tykypj314s0nawr3.jpg)
![内网IP](http://ww1.sinaimg.cn/large/005BIQVbgy1fupdzr3nbcj30rl0efwf7.jpg)
- 查看本机外网IP
打开百度，搜索ip地址，会直接显示你本机的外网IP。
![百度搜索ip地址](http://ww1.sinaimg.cn/large/005BIQVbgy1fupe5ixmprj31hc0hhq97.jpg)
- 查看一个网站的IP地址
可以在命令提示符里ping网站的域名，能显示Ip地址。（部分是不可以的）
![pingQQ网站](http://ww1.sinaimg.cn/large/005BIQVbgy1fupe8csdqhj30rl0ef3yx.jpg)