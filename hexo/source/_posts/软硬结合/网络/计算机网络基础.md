---
title: 计算机网络基础
abbrlink: 37707
date: 2018-08-25 10:09:09
tags:
toc: true
---

&emsp;网上的教程只有短短十几分钟的阅读量，是做不到全面的系统性学习，只能从中简单了解。要想系统性地学习，踏踏实实地获取知识，就要啃书：[《计算机网络第五版-谢希仁》-百度网盘](https://pan.baidu.com/s/1MCiXSAIv0hPSqwf_gWcHGw)。建议去图书馆借阅纸质书或联系计算机专业通信专业的同学去借书，大约花两天的时间，快速翻阅完前6章，不必太扣细节，等你觉得需要研究时再深入研究，对所有概念有个简单的认识。

# 简介
&emsp;网络通信的首要问题是，__如何确定是谁给谁发送数据。__
> 不同的房屋使用门牌号来区分，房屋里不同的房间使用房间号来区分。
不同的电脑使用IP地址来区分，电脑里不同的程序使用不同的端口号来区分。

&emsp;现在的IP地址（IPv4，下一代是IPv6）是由4个字节（即32位）组成。每一台电脑都拥有不同的IP地址。IP地址长这样的（图片来自于《计算机网络-谢希仁》）：
![点分十进制](http://ww1.sinaimg.cn/large/005BIQVbgy1fuo1rwsry0j30t3097jtr.jpg)
&emsp;不同的程序如何交换数据，有很多种方法，其中一种是通过套接字（socket）来通信。__在套接字接口中，以IP地址及通信端口组成套接字地址（socket address）。__
&emsp;这个例子是模拟Berkeley套接字接口，我们通过 __80端口__ 发送`hello,world`到 __1.2.3.4的主机__ 上。下方代码演示了创建接口、连接远程主机、发送数据和关闭接口的过程。[维基百科-网络套接字](https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E6%8F%92%E5%BA%A7)
```c
Socket socket = getSocket(type = "TCP")
connect(socket, address = "1.2.3.4", port = "80")
send(socket, "Hello, world!")
close(socket)
```
&emsp;为了方便举例，我们先假设两个电脑分别有两个程序在通信。电脑A的IP址址1.2.3.4、程序a的端口号80。电脑B的IP址址6.7.8.9、程序b的端口号2400。两个程序通信是这样的：
```
1.2.3.4:80 <--> 6.7.8.9:2400 
```
&emsp;我们再次讲一下手机浏览器打开网页的过程。对应上面的例子，手机的IP地址是6.7.8.9，浏览器所用的端口号是2400。云服务器的IP地址是1.2.3.4，端口号是80。整个过程是这样的：云服务器提供的网页服务是24小时运行，所以1.2.3.4一直在监听80端口，看有没有人接进来，如果有人接进来请求网页的话，就返回网页数据给它。我打开手机，连上WIFI，通信运营商（电信、移动这些）给我动态分配了一个IP地址为6.7.8.9，我打开浏览器，手机操作系统动态分配一个2400端口给浏览器，我输入网址，连接到1.2.3.4:80获取到网页数据。
![手机打开网页的socket通信示意图](http://ww1.sinaimg.cn/large/005BIQVbgy1fuo2rfdp2oj30iv0bnglw.jpg)
&emsp;对套接字通信有个整体的初步认识后，我们继续讨论一下IP地址与端口。
# IP协议（Internet Protocol 网际协议）
## 外网IP与内网IP基础
&emsp;首先看看常见的网络类型：
![外网IP与内网IP](http://ww1.sinaimg.cn/large/005BIQVbgy1fuoemhdd56j30rr0iwjs6.jpg)

场景|是否接入互联网|是否向外提供服务|例子
---|---|---|---
A类|√|√|提供网页服务的云服务器
B类|×|×|公安局用于存放敏感数据的服务器
C类|√|×|企业网络、家庭网络


&emsp;由于接入网络的电脑数量超出了设计者的设想，IPv4的地址并不够用，随时有超出的可能，所以提出了很多解决方案，除了IPv6（号称给地球所有东西都能分配一个独立的IP地址）之外，还有划分子网的方案，并让IPv4一直续命至今。现在IP地址不够用了，于是设计者把一部分IP地址列为私有IP，让处于内网的电脑使用私有IP，对外的使用公有IP。如上图所示，按旧的做法，所有接入互联网的电脑，都需要一个IP地址，A类一台电脑1个，C类三台电脑3个，共需要4个公有IP地址。划分子网后，A类电脑占用1个公有IP地址，C类三台电脑共使用1个公有IP地址，子网里使用3个私有IP来相互区分。  __公有IP代表全球独一无二的IP地址，不可重复。而私有IP代表内网地址，只需要内网里保证独一无二即可。__ 
> 普通扩容思想：10+10=20
分级扩容思想：10*10=100

&emsp;A类电脑需要向外提供服务，所以IP地址需要固定不变。而C类电脑并不需要向外提供服务，所以运营商会给这些电脑的调解网关动态分配IP地址就可以了，当这些电脑不用时，可以把这个IP地址再分配给别人。
&emsp;被列入私有IP地址是：
- 10.0.0.0        -   10.255.255.255  (10/8 prefix)
- 172.16.0.0      -   172.31.255.255  (172.16/12 prefix)
- 192.168.0.0     -   192.168.255.255 (192.168/16 prefix)

&emsp;另外一下，有一个IP地址很特别而且经常用到：127.0.0.1 代表本机IP地址。

## 查看IP地址
- 查看本机内网IP 
打开命令提示符（win+R 输入cmd，或在菜单里输入cmd搜索）,输入ipconfig。
![打开cmd](http://ww1.sinaimg.cn/large/005BIQVbgy1fupe1tykypj314s0nawr3.jpg)
![内网IP](http://ww1.sinaimg.cn/large/005BIQVbgy1fupdzr3nbcj30rl0efwf7.jpg)
- 查看本机外网IP
打开百度，搜索ip地址，会直接显示你本机的外网IP。
![百度搜索ip地址](http://ww1.sinaimg.cn/large/005BIQVbgy1fupe5ixmprj31hc0hhq97.jpg)
- 查看一个网站的IP地址
可以在命令提示符里ping网站的域名，能显示Ip地址。（部分是不可以的）
![pingQQ网站](http://ww1.sinaimg.cn/large/005BIQVbgy1fupe8csdqhj30rl0ef3yx.jpg)


# 端口号
&emsp;端口是指逻辑意义上用于区分服务的端口，如TCP/IP协议中的服务端口，端口号的范围从0到65535，比如用于浏览网页服务的80端口，用于FTP服务的21端口等。一个IP地址的端口通过16bit进行编号，最多可以有65536个端口。端口是通过端口号来标记的，端口号只有整数，范围是从0 到65535。
&emsp;公认端口（Well-Known Ports），范围从0到1023，这些端口号一般固定分配给一些服务。比如21端口分配给FTP(文件传输协议)服务，25端口分配给SMTP（简单邮件传输协议）服务，80端口分配给HTTP服务，135端口分配给RPC（远程过程调用）服务等等。
&emsp;动态端口,范围从1024到65535，只要运行的程序向系统提出访问网络的申请，那么系统就可以从这些端口号中分配一个供该程序使用。在关闭程序进程后，就会释放所占用的端口号。
&emsp;以上内容，全是复制于[端口号-百度百科](https://baike.baidu.com/item/%E7%AB%AF%E5%8F%A3%E5%8F%B7)，别人写得好的东西我就直接借用，不再浪费时间了。

# 附录
- [内网IP的规范文档-rfc1918](https://tools.ietf.org/html/rfc1918)









