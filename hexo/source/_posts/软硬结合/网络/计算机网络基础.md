---
title: 计算机网络基础
abbrlink: 37707
date: 2018-08-25 10:09:09
tags:
toc: true
---

&emsp;网上的教程只有短短十几分钟的阅读量，是做不到全面的系统性学习，只能从中简单了解。要想系统性地学习，踏踏实实地获取知识，就要啃书：[《计算机网络第五版-谢希仁》-百度网盘](https://pan.baidu.com/s/1MCiXSAIv0hPSqwf_gWcHGw)。建议去图书馆借阅纸质书或联系计算机专业通信专业的同学去借书，大约花两天的时间，快速翻阅完前6章，不必太扣细节，等你觉得需要研究时再深入研究，对所有概念有个简单的认识。

# 简介
&emsp;数据要传输，就需要通信。网络通信的首要问题是，__如何确定是谁给谁发送数据。__
> 不同的房屋使用门牌号来区分，房屋里不同的房间使用房间号来区分。
不同的电脑使用IP地址来区分，电脑里不同的程序使用不同的端口号来区分。

&emsp;现在的IP地址（IPv4，下一代是IPv6）是由4个字节（即32位）组成。每一台电脑都拥有不同的IP地址。IP地址长这样的（图片来自于《计算机网络-谢希仁》）：
![点分十进制](http://ww1.sinaimg.cn/large/005BIQVbgy1fuo1rwsry0j30t3097jtr.jpg)
&emsp;不同的程序如何交换数据，有很多种方法，其中一种是通过套接字（socket）来通信。__在套接字接口中，以IP地址及通信端口组成套接字地址（socket address）。__
&emsp;这个例子是模拟Berkeley套接字接口，我们通过 __80端口__ 发送`hello,world`到 __1.2.3.4的主机__ 上。下方代码演示了创建接口、连接远程主机、发送数据和关闭接口的过程。[维基百科-网络套接字](https://zh.wikipedia.org/wiki/%E7%B6%B2%E8%B7%AF%E6%8F%92%E5%BA%A7)代码不了解没关系，暂时只需要明白一件事：__通信时是需要IP地址与端口号。__ 
```c
Socket socket = getSocket(type = "TCP")
connect(socket, address = "1.2.3.4", port = "80")
send(socket, "Hello, world!")
close(socket)
```
&emsp;为了方便举例，我们先假设两个电脑分别有两个程序在通信。电脑A的IP址址1.2.3.4、程序a的端口号80。电脑B的IP址址6.7.8.9、程序b的端口号2400。两个程序通信是这样的：
```
1.2.3.4:80 <--> 6.7.8.9:2400 
```
&emsp;我们再次以手机浏览器打开网页的过程为例。对应上面的数据，手机的IP地址是6.7.8.9，浏览器所用的端口号是2400。云服务器的IP地址是1.2.3.4，端口号是80。整个过程是这样的：云服务器提供的网页服务是24小时运行，所以1.2.3.4一直在监听80端口，看有没有人接进来，如果有人接进来请求网页的话，就返回网页数据给它。我打开手机，连上WIFI，通信运营商（电信、移动这些）给我动态分配了一个IP地址为6.7.8.9，我打开浏览器，手机操作系统动态分配一个2400端口给浏览器，我输入网址，连接到1.2.3.4:80获取到网页数据。所谓的网址，其实还是会通过DNS服务转换成IP地址，然后继续通信。暂时只需要明白一件事：__访问网页，本质是一台设备从另一台设备上获取网页数据并展示出来（数据传输即通信，网络通信需要IP地址与端口号）。__ 
![手机打开网页的socket通信示意图](http://ww1.sinaimg.cn/large/005BIQVbgy1fuo2rfdp2oj30iv0bnglw.jpg)
&emsp;对套接字通信有个整体的初步认识后，我们继续讨论一下IP地址与端口。
# 基础
## IP协议
&emsp;在讨论IP协议（Internet Protocol 网际协议）之前，需要先对整体有个了解，知道IP协议是在网络通信中的哪个一环节。网络通信时可以大概划分成四层，上层依赖于下层：访问网页使用的是HTTP协议，属于最上层的应用层。而应用层依赖于传输层，以HTTP协议为例，它是基于可靠通信的TCP协议（下一节单独讨论）。而TCP协议又是基于IP协议的。而IP协议之下，就是具体的硬件设备，如网卡。
![TCP/IP协议模型](http://ww1.sinaimg.cn/large/005BIQVbgy1fvi66culs3j30if0d674z.jpg)
&emsp;我们继续以HTTP通信为例，分解成四层就是这样：
![HTTP通信过程](http://ww1.sinaimg.cn/large/005BIQVbgy1fvi5wtnbqej30h80dbmx6.jpg)
&emsp;从下往上看。第一层链路层，它负责两个设备之间数据传输（可以理解为两台设备用线连接起来，能传输数据了）。第二层网络层，将数据设法从源端经过若干个中间节点传送到目的端，提供最基本的端到端的数据传送服务。（这一层就是使用IP协议，IP地址可以理解为网络通信时的门牌号，IP协议会经过几个中间点来找到所需要通信的IP地址）。第三层传输层，控制端对端数据传输时的速度与质量。（TCP协议是可靠通信协议，当发现对面没有接收到已经发送的数据，会重新再发送一次。）第四层应用层，提供特定的应用服务。（HTTP协议就是用来提供网页访问的服务）
&emsp;暂时只需要明白几件事：
1. __IP协议属于第二层，网络层（从下往上数）。__
2. __上层协议依赖于下层协议。（下一节会详细讨论）__
3. __各层负责不同的事。__

&emsp;你想知道的其它知识，会最终由你带着疑问啃书而得到完美的解答，暂时只简单地讲一下。（因为讲太细就相当于啃书，没有人愿意一开始就接受长篇大论。）

## CS模型
&emsp;CS模型（client-server model）客户-服务器模型。
&emsp;网络应用程序可以分为两种，一种是客户端，另一种是服务器端。服务器端的程序反复做的事：
1. 等待客户端的请求。
2. 处理客户端的请求
3. 发送响应给所请求的客户端。
4. 重新回到步骤1。

## 端口号
&emsp;传输层（TCP协议与UDP协议）是使用16位端口号（从0到65535）来识别程序。那么程序是怎么选择使用哪个端口号呢？
&emsp;对应服务器端程序来说，公认端口（Well-Known Ports），范围从0到1023，这些端口号一般固定分配给一些服务。比如21端口分配给FTP(文件传输协议)服务，25端口分配给SMTP（简单邮件传输协议）服务，80端口分配给HTTP服务，135端口分配给RPC（远程过程调用）服务等等。
&emsp;而对应客户端应用程序来说，__随意用哪个端口都行，我们没所谓__。动态端口,范围从1024到65535，只要运行的程序向系统提出访问网络的申请，那么系统就可以从这些端口号中分配一个供该程序使用。在关闭程序进程后，就会释放所占用的端口号。
&emsp;以上内容，全是复制于[端口号-百度百科](https://baike.baidu.com/item/%E7%AB%AF%E5%8F%A3%E5%8F%B7)，别人写得好的东西我就直接借用，不再浪费时间了。

## 外网IP与内网IP
&emsp;首先看看常见的网络类型：
![外网IP与内网IP](http://ww1.sinaimg.cn/large/005BIQVbgy1fuoemhdd56j30rr0iwjs6.jpg)
&emsp;想一下我们电脑怎么连接上网的。喊电信移动给家里装宽带，工作人员就会给你家里安装一台拨号器与路由器，路由器与拨号器相连，电脑与路由器相连。公司也一样，不过是电脑多一些，可能会有几台路由器，而这些路由器最终都会连接到拨号器。对应上图的C类。

场景|是否接入互联网|是否向外提供服务|例子
---|---|---|---
A类|√|√|提供网页服务的云服务器
B类|×|×|公安局用于存放敏感数据的服务器
C类|√|×|企业网络、家庭网络


&emsp;由于接入网络的电脑数量超出了设计者的设想，IPv4的地址并不够用，随时有超出的可能，所以提出了很多解决方案，除了IPv6（号称给地球所有东西都能分配一个独立的IP地址）之外，还有划分子网的方案，并让IPv4一直续命至今。现在IP地址不够用了，于是设计者把一部分IP地址列为私有IP，让处于内网的电脑使用私有IP，对外的使用公有IP。如上图所示，按旧的做法，所有接入互联网的电脑，都需要一个IP地址，A类一台电脑1个，C类三台电脑3个，共需要4个公有IP地址。划分子网后，A类电脑占用1个公有IP地址，C类三台电脑共使用1个公有IP地址，子网里使用3个私有IP来相互区分。  __公有IP代表全球独一无二的IP地址，不可重复。而私有IP代表内网地址，只需要内网里保证独一无二即可。__ 

&emsp;A类电脑需要向外提供服务，所以IP地址需要固定不变。而C类电脑并不需要向外提供服务，所以运营商会给这些电脑的调解网关动态分配IP地址就可以了，当这些电脑不用时，可以把这个IP地址再分配给别人。

&emsp;被列入私有IP地址是：
- 10.0.0.0        -   10.255.255.255  (10/8 prefix)
- 172.16.0.0      -   172.31.255.255  (172.16/12 prefix)
- 192.168.0.0     -   192.168.255.255 (192.168/16 prefix)

&emsp;另外一下，有一个IP地址很特别而且经常用到：127.0.0.1 代表本机IP地址。

## 查看IP地址
- 查看本机内网IP 
打开命令提示符（win+R 输入cmd，或在菜单里输入cmd搜索）,输入ipconfig。
![打开cmd](http://ww1.sinaimg.cn/large/005BIQVbgy1fupe1tykypj314s0nawr3.jpg)
![内网IP](http://ww1.sinaimg.cn/large/005BIQVbgy1fupdzr3nbcj30rl0efwf7.jpg)
- 查看本机外网IP
打开百度，搜索ip地址，会直接显示你本机的外网IP。
![百度搜索ip地址](http://ww1.sinaimg.cn/large/005BIQVbgy1fupe5ixmprj31hc0hhq97.jpg)
- 查看一个网站的IP地址
可以在命令提示符里ping网站的域名，能显示Ip地址。（部分是不可以的）
![pingQQ网站](http://ww1.sinaimg.cn/large/005BIQVbgy1fupe8csdqhj30rl0ef3yx.jpg)



# 附录
- [内网IP的规范文档-rfc1918](https://tools.ietf.org/html/rfc1918)









