<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="技术记录与心得分享，及《软硬结合——从零打造物联网》、《3D可视化教程》两个系列教程。"><meta name="baidu-site-verification" content="xsF0k2IpTd"><meta name="360-site-verification" content="17062a868693e9ab70b4c9543d98059b"><meta name="sogou_site_verification" content="VAcZeTHOK4"><meta name="google-site-verification" content="_1T1ah4LkGnFPqgYs6wQqN27O6PfrXJqG8gbFwh7ClM"><title>【软硬结合】软硬结合调试技巧 | 生子当如哈士奇的个人博客</title><script type="text/javascript" src="/sw-init.js"></script><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/css/normalize.min.css"><link rel="stylesheet" type="text/css" href="/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/css/grids-responsive-min.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><script type="text/javascript" src="/js/jquery-3.3.1.min.js"></script><script type="text/javascript" src="/js/lazyload.8.16.0.min.js"></script><link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css"><script type="text/javascript" src="/js/bootstrap.min.js"></script><link rel="stylesheet" type="text/css" href="/css/bootstrap-treeview.min.css"><script type="text/javascript" src="/js/bootstrap-treeview.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '646acd4e6c74eb119c3d5d93c5bfde70';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><link rel="stylesheet" type="text/css" href="/css/index.css"><script type="text/javascript" src="/js/slideout.min.js"></script><script type="text/javascript" src="/js/image-fullscreen.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><nav class="navbar navbar-default"><div class="container-fluid navbar-custom"><!-- Brand and toggle get grouped for better mobile display--><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="#">导航栏</a></div><!-- Collect the nav links, forms, and other content for toggling--><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"><ul class="nav navbar-nav"><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">软硬结合——从零打造物联网 <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/44755">导读</a></li><li><a href="/posts/31494">1.NodeMCU基础</a></li><li><a href="/posts/64786">2.demo1跑起来</a></li><li><a href="/posts/64594">3.demo2跑起来</a></li><li><a href="/posts/31687">4.部署到云服务器</a></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">亲手实现demo0.1</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/37707">5.计算机网络基础</a></li><li><a href="/posts/7602">6.NodeMCU与网络调试助手联调</a></li><li><a href="/posts/58215">7.使用NodeJs实现TCP服务器</a></li><li><a href="/posts/54080">8.HTML、CSS、JS基础</a></li><li><a href="/posts/33173">9.使用NodeJs实现HTTP服务器</a></li><li><a href="/posts/38208">10.亲手实现demo0.1     </a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">亲手实现demo1</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/27238">11.Bootstrap基础</a></li><li><a href="/posts/22339">12.Express框架</a></li><li><a href="/posts/24742">13.亲手实现demo1</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">亲手实现demo2</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/18173">14.数据可视化基础</a></li><li><a href="/posts/21192">15.Websocket协议</a></li><li><a href="/posts/41347">16.数据库基础</a></li><li><a href="/posts/29864">17.亲手实现demo2</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">其它补充</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/52429">chrome开发者工具</a></li><li><a href="/posts/54436">软硬结合调试技巧</a></li><li><a href="/posts/15341">将demo2制作成微信小程序</a></li><li><a href="/posts/1041">将demo2制作成exe应用程序</a></li><li><a href="/posts/34982">Linux基础</a></li><li><a href="/posts/41995">最后的讨论</a></li></ul></li></ul></li><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">3D可视化教程（Web）<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/30679/">导读</a></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">项目示例</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/2544">模型拆解示例</a></li><li><a href="/posts/46791">智慧城市</a></li><li><a href="/posts/15060">地球数据流                  </a></li><li><a href="/posts/19890">数据中心</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">基础示例</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/42378">1-模型制作与展示</a></li><li><a href="/posts/45270">2-模型数据                 </a></li><li><a href="/posts/5988">3-光线痕迹</a></li><li><a href="/posts/60366">4-动画</a></li><li><a href="/posts/52736">5-显示动态图               </a></li><li><a href="/posts/56155">6-屏幕坐标转换</a></li><li><a href="/posts/48386">7-开关门(不动点)              </a></li><li><a href="/posts/30581">8-聚焦靠近</a></li><li><a href="/posts/59091">9-容量模式           </a></li><li><a href="/posts/62843">10-曲线移动</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">Blender相关</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/46886">常用操作</a></li><li><a href="/posts/20949">导入城市建筑(.osm)                </a></li><li><a href="/posts/4195">导入城市建筑(.rdc)     </a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">其它</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/31929">3D案例收集</a></li><li><a href="/posts/27566">PS常用技巧              </a></li><li><a href="/posts/47064">PS制作科技感界面  </a></li><li><a href="/posts/5200">three.js性能优化</a></li><li><a href="/posts/1192">线性代数基础知识归纳              </a></li><li><a href="/posts/44479">3D温场效果  </a></li><li><a href="/posts/3280">线框转换效果</a></li></ul></li></ul></li><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">杂谈<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/posts/62923/">推荐书籍</a></li><li><a href="/posts/61760/">工具推荐</a></li><li><a href="/posts/44837/">人生一百种失败方法</a></li><li><a href="/posts/25883/">分享当面试官的经验</a></li></ul></li><li><a href="/archives">所有文章<span class="sr-only">(current)</span></a></li><li><a href="/posts/13104">云服务器优惠<span class="sr-only">(current)</span></a></li><li><a href="/posts/23630">关于<span class="sr-only">(current)</span></a></li></ul></div></div></nav><main class="body_container"><header><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">【软硬结合】软硬结合调试技巧</h1><div class="post-meta">May 10, 2020<span> | </span><span class="category"><a href="/categories/%E8%BD%AF%E7%A1%AC%E7%BB%93%E5%90%88/">软硬结合</a><a href="/categories/%E8%BD%AF%E7%A1%AC%E7%BB%93%E5%90%88/%E5%85%B6%E5%AE%83/">其它</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a class="disqus-comment-count" href="/posts/54436/#vcomment"><span class="valine-comment-count" data-xid="/posts/54436/"></span><span> 条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E7%9A%84"><span class="toc-number">1.</span> <span class="toc-text">目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95%E6%96%B9%E6%B3%95"><span class="toc-number">2.</span> <span class="toc-text">调试方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B0%83%E8%AF%95"><span class="toc-number">3.</span> <span class="toc-text">调试</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A4%E6%96%AD%E5%87%BA%E7%8E%B0%E9%97%AE%E9%A2%98%E7%9A%84%E7%8E%AF%E8%8A%82"><span class="toc-number">4.</span> <span class="toc-text">判断出现问题的环节</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%93%E6%96%AD%E7%82%B9%E5%88%86%E6%9E%90"><span class="toc-number">5.</span> <span class="toc-text">打断点分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vscode%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95"><span class="toc-number">5.1.</span> <span class="toc-text">vscode断点调试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%89%8D%E7%AB%AF%E6%96%AD%E7%82%B9%E8%B0%83%E8%AF%95"><span class="toc-number">5.2.</span> <span class="toc-text">前端断点调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E5%B7%A5%E5%85%B7"><span class="toc-number">6.</span> <span class="toc-text">其它工具</span></a></li></ol></div></div><div class="post-content"><h2 id="目的"><a href="#目的" class="headerlink" title="目的"></a>目的</h2><p>&emsp;有些读者已经跑完demo2，当他尝试去修改代码时，往往发现达不到他所预期的效果，但又不知怎么做，其本质就是不知道怎么调试。这里我以demo2为例来示范调试技巧。</p>
<h2 id="调试方法"><a href="#调试方法" class="headerlink" title="调试方法"></a>调试方法</h2><p>&emsp;调试的作用是当发现异常时，不断地调试，判断可能出现异常的地方，不断地缩小范围，直到找到发生异常的代码段，然后修复导致异常的代码。</p>
<ul>
<li>打印调试法：在关键的地方打印关注的数据，看打印的信息来判断该环节是否符合预期。</li>
<li>断点调试法：进入调试模式并打断点，当代码运行到断点时代码会暂时到该处，此时可以看各变量是否符合预期，并可一步步地往下执行单行代码。</li>
</ul>
<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p><img src="/blog_images/demo2.webp" alt=""></p>
<p>&emsp;我们来看看从左到右，即从TCP客户端到后端（服务器）到前端（网页）,数据是怎么变化的。<br>&emsp;首先在vscode里执行命令<code>npm run start</code>启动demo2，可以看到，用于方便调试模拟硬件充当TCP客户端的<code>bin\tcp-client.js</code>连接上了TCP服务器，发送的第一条消息是<code>123456</code>，而TCP服务器将其信息打印出来:<code>127.0.0.1:56813 receive: 123456</code>（第一条消息是充当设备ID的，后面消息才是模拟温度数据）。同理，后面的数据则是<code>127.0.0.1:56813 receive: 20.83</code>，代码TCP客户端向TCP服务器发送了<code>20.83</code>这条数据。通过查看打印的信息，我们就可以知道，TCP客户端向TCP服务器发送了什么数据，如果发现数据异常可以从这里看出来。<br><img src="/blog_images/启动demo2.webp" alt=""></p>
<p>&emsp;TCP服务器会把接收到的数据存放到数据库，当打开网页时查询历史数据时，就会把最近的历史数据发送到前端。我们打开MongoDB图形化客户端Robo 3T连接到MongoDB，查看所保存的数据。可以看到，数据库保存数据的格式，跟代码<code>mongodb.insert(&#123;id:socket.id,data:socket.lastValue&#125;)</code>是一致的，是<code>&#123;id:...,data:...&#125;</code>的样子：<br><img src="/blog_images/查看demo2在数据库里的数据.webp" alt=""></p>
<p>&emsp;然后，打开网页<code>http://127.0.0.1:8002</code>，马上展示历史数据，并且打开调试工具，从console打印出来的信息可以看到websocket发来的实时数据。<br><img src="/blog_images/demo2打开网页.webp" alt=""></p>
<p>&emsp;历史数据的HTTP请求，可以在network里找到，并看到响应回来的数据，跟后端从数据库查询数据并响应的代码相对应：<br><img src="/blog_images/demo2历史数据.webp" alt=""></p>
<p>&emsp;websocket的通信，也是可以在network里找到，可以看到前端向服务器发送了一条<code>&#123;&quot;equipmentId&quot;:&quot;123456&quot;&#125;</code>数据代表订阅该设备的实时数据，然后不断地接收从后端发过来的实时数据：<br><img src="/blog_images/demo2实时websocket数据.webp" alt=""></p>
<h2 id="判断出现问题的环节"><a href="#判断出现问题的环节" class="headerlink" title="判断出现问题的环节"></a>判断出现问题的环节</h2><p>&emsp;那么，回到原来的问题：当我修改了部分代码，然后发现前端页面显示数据不正常时，如何去判断是哪个环节出了问题？<br>&emsp;首先，就是在调试工具network看HTTP请求与websocket请求是否得到预期的数据？若得到预期的数据，说明就是前端代码出了问题。若得到就说明上一环节出了问题。若没发出请求，说明是前端代码出了问题，没有向后端请求数据。<br>&emsp;来到上一环节服务器端，检查从TCP客户端接收的数据是否如得到所预期的数据，若没有说明是上一环节的问题（硬件或者网络问题），若正常得到数据，则说明不是TCP客户端的问题，检查服务器端这一环节。没有历史数据，则查看数据库是否如你预期那样保存了数据，若没有说明保存数据库这一环节出了问题。<br>&emsp;这样，通过逆向的数据流分析，一环环地往上进行排查，判断是哪个环节出了问题。</p>
<h2 id="打断点分析"><a href="#打断点分析" class="headerlink" title="打断点分析"></a>打断点分析</h2><p>&emsp;很多时候，我们需要更详细的上下文信息来调试，则需要打断点：</p>
<h3 id="vscode断点调试"><a href="#vscode断点调试" class="headerlink" title="vscode断点调试"></a>vscode断点调试</h3><p>&emsp;首先要找到你要调试的文件，由于我们是想调试整个项目，所以我们要找到整个项目的入口文件，express框架的入口就是<code>bin/www</code>，这个文件启动就会启动整个项目。<br><img src="/blog_images/express断点调试.webp" alt=""><br>&emsp;在启动调试之前或之后，可以点击代码行数前，单击出红点，那就是你想要调试的断点，当代码运行到断点处时就会暂停：<br><img src="/blog_images/vscode断点调试.webp" alt=""><br>&emsp;这样就能断点调试你的后端代码。</p>
<h3 id="前端断点调试"><a href="#前端断点调试" class="headerlink" title="前端断点调试"></a>前端断点调试</h3><p>&emsp;类似的，前端断点调试是打开调试工具，进入Sources栏，找到JS文件的地方并在代码行数前点击生成断点：<br><img src="/blog_images/前端断点调试.webp" alt=""><br>&emsp;特别地，前端代码有时被压缩打包（如webpack打包处理）后，通过手动打断点可能不行，可以在前端代码里输入<code>debugger</code>,就会打断点。</p>
<h2 id="其它工具"><a href="#其它工具" class="headerlink" title="其它工具"></a>其它工具</h2><ul>
<li>postman常用于HTTP API的调试，如同调试TCP的网络调试助手,<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/97ba64888894">Postman教程大全-简书</a>。</li>
<li>websocket在线调试工具：<a target="_blank" rel="noopener" href="https://www.websocket.org/echo.html">websocket.org</a>，或者百度搜索websocket在线调试工具。</li>
</ul>
</div><div class="tags"></div><div id="vcomment"></div><script src="/js/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var serverURLs = 'https://leancloud.scaugreen.cn'
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  serverURLs:serverURLs,
  notify:notify,
  verify:verify,
  appId:'dibwgE5SQgKyFS1KqM3C2WmQ-gzGzoHsz',
  appKey:'G24uL9Fw9oNCfheBorc3GjVB',
  placeholder:'欢迎留言交流',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer"><div> <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn">粤ICP备16092003号</a></div></div></div></div><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script><script type="text/javascript" src="/js/index.js"></script></header></main><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"log":false});</script></body></html>