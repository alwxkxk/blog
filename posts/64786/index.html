<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="生子当如哈士奇的个人博客，包含若干技术文章，以及《软硬结合——从零打造物联网》、《3D可视化教程》两个系列教程。"><meta name="baidu-site-verification" content="xsF0k2IpTd"><meta name="360-site-verification" content="17062a868693e9ab70b4c9543d98059b"><meta name="sogou_site_verification" content="VAcZeTHOK4"><meta name="google-site-verification" content="_1T1ah4LkGnFPqgYs6wQqN27O6PfrXJqG8gbFwh7ClM"><script data-ad-client="ca-pub-5955811496112897" async="" src="https://pagead2.googlesyndication.com/pagead/blog/js/adsbygoogle.js"></script><title>demo1 | 生子当如哈士奇的个人博客</title><script type="text/javascript" src="/sw-init.js"></script><link rel="stylesheet" type="text/css" href="/blog/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="/blog/css/normalize.min.css"><link rel="stylesheet" type="text/css" href="/blog/css/pure-min.css"><link rel="stylesheet" type="text/css" href="/blog/css/grids-responsive-min.css"><link rel="stylesheet" href="/blog/css/font-awesome.min.css"><script type="text/javascript" src="/blog/js/jquery-3.3.1.min.js"></script><script type="text/javascript" src="/blog/js/lazyload.8.16.0.min.js"></script><link rel="stylesheet" type="text/css" href="/blog/css/bootstrap.min.css"><script type="text/javascript" src="/blog/js/bootstrap.min.js"></script><link rel="stylesheet" type="text/css" href="/blog/css/bootstrap-treeview.min.css"><script type="text/javascript" src="/blog/js/bootstrap-treeview.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/blog/favicon.ico"><link rel="apple-touch-icon" href="/blog/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/blog/apple-touch-icon.png"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = 'https://hm.baidu.com/hm.js?' + '646acd4e6c74eb119c3d5d93c5bfde70';
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><link rel="stylesheet" type="text/css" href="/blog/css/index.css"><script type="text/javascript" src="/blog/js/slideout.min.js"></script><script type="text/javascript" src="/blog/js/image-fullscreen.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/blog/js/totop.js?v=0.0.0" async></script><nav class="navbar navbar-default"><div class="container-fluid navbar-custom"><!-- Brand and toggle get grouped for better mobile display--><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><a class="navbar-brand" href="#">导航栏</a></div><!-- Collect the nav links, forms, and other content for toggling--><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1"><ul class="nav navbar-nav"><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">软硬结合——从零打造物联网 <span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/44755">导读</a></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">项目演示</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/38208">demo0.1</a></li><li><a href="/blog/posts/64786">demo1</a></li><li><a href="/blog/posts/64594">demo2</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">网络通信</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/37707">计算机网络基础</a></li><li><a href="/blog/posts/37286">IP协议基础</a></li><li><a href="/blog/posts/19508">TCP协议基础</a></li><li><a href="/blog/posts/34265">HTTP协议基础</a></li><li><a href="/blog/posts/20945">MQTT协议基础（选学）</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">客户端开发</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/54080">HTML、CSS、JS基础</a></li><li><a href="/blog/posts/52429">chrome开发者工具</a></li><li><a href="/blog/posts/27238">Jquery、Bootstrap基础</a></li><li><a href="/blog/posts/18173">数据可视化基础</a></li><li><a href="/blog/posts/15341">微信小程序基础</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">服务器开发</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/56793">NodeJs基础</a></li><li><a href="/blog/posts/34982">Linux基础</a></li><li><a href="/blog/posts/19114">Nginx基础</a></li><li><a href="/blog/posts/41347">数据库基础</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">硬件</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/32577">ESP8266基础</a></li><li><a href="/blog/posts/31494">nodemcu基础</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">其它</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/54436">调试技巧</a></li><li><a href="/blog/posts/61760">工具推荐                  </a></li><li><a href="/blog/posts/37993">资源链接汇总</a></li><li><a href="/blog/posts/41995">最后的讨论     </a></li></ul></li></ul></li><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">3D可视化教程（Web）<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/30679/">导读</a></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">项目示例</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/2544">a-模型拆解示例</a></li><li><a href="/blog/posts/46791">b-智慧城市                 </a></li><li><a href="/blog/posts/19890">c-数据中心</a></li><li><a href="/blog/posts/3280">d-线框转换效果</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">基础示例</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/42378">1-模型制作与展示</a></li><li><a href="/blog/posts/45270">2-模型数据                 </a></li><li><a href="/blog/posts/5988">3-光线痕迹</a></li><li><a href="/blog/posts/60366">4-动画</a></li><li><a href="/blog/posts/52736">5-显示动态图               </a></li><li><a href="/blog/posts/56155">6-屏幕坐标转换</a></li><li><a href="/blog/posts/48386">7-开关门(不动点)              </a></li><li><a href="/blog/posts/30581">8-聚焦靠近</a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">Blender相关</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/46886">常用操作</a></li><li><a href="/blog/posts/20949">导入城市建筑(.osm)                </a></li><li><a href="/blog/posts/4195">导入城市建筑(.rdc)     </a></li></ul></li><li class="dropdown-submenu"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><span class="nav-label">其它</span><span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/31929">3D案例收集</a></li><li><a href="/blog/posts/27566">PS常用技巧              </a></li><li><a href="/blog/posts/47064">PS制作科技感界面  </a></li><li><a href="/blog/posts/5200">three.js性能优化</a></li><li><a href="/blog/posts/1192">线性代数基础知识归纳              </a></li><li><a href="/blog/posts/44479">3D温场效果  </a></li></ul></li></ul></li><li class="dropdown"><a class="dropdown-toggle" href="#" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">杂谈<span class="caret"></span></a><ul class="dropdown-menu"><li><a href="/blog/posts/62923/">推荐书籍</a></li><li><a href="/blog/posts/61760/">工具推荐</a></li><li><a href="/blog/posts/44837/">人生一百种失败方法</a></li><li><a href="/blog/posts/25883/">分享当面试官的经验</a></li></ul></li><li><a href="/blog/archives">所有文章<span class="sr-only">(current)</span></a></li><li><a href="/blog/posts/23630">关于<span class="sr-only">(current)</span></a></li></ul></div></div></nav><main class="body_container"><header><div id="header"><div class="site-name"><h1 class="hidden">demo1</h1><a id="logo">生子当如哈士奇的个人博客</a><p class="description">生子当如哈士奇的个人博客，包含若干技术文章，以及《软硬结合——从零打造物联网》、《3D可视化教程》两个系列教程。</p></div><div id="nav-menu"></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-4-4"><div class="content_container"><div class="post"><h1 class="post-title">demo1</h1><div class="post-meta">Nov 1, 2018<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a class="disqus-comment-count" href="/blog/posts/64786/#vcomment"><span class="valine-comment-count" data-xid="/blog/posts/64786/"></span><span> 条评论</span></a><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%88%E8%B7%91%E8%B5%B7%E6%9D%A5"><span class="toc-number">1.</span> <span class="toc-text">先跑起来</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9C%A8%E8%87%AA%E5%B7%B1%E7%94%B5%E8%84%91%E4%B8%8A%E8%B7%91%E8%B5%B7%E6%9D%A5"><span class="toc-number">2.</span> <span class="toc-text">在自己电脑上跑起来</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%BA%90%E7%A0%81"><span class="toc-number">2.1.</span> <span class="toc-text">获取源码</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E7%8E%AF%E5%A2%83"><span class="toc-number">2.2.</span> <span class="toc-text">安装环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85%E5%B9%B6%E8%BF%90%E8%A1%8C"><span class="toc-number">2.3.</span> <span class="toc-text">安装依赖包并运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9E%8E%E6%8A%98%E8%85%BE"><span class="toc-number">2.4.</span> <span class="toc-text">瞎折腾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%8E%E4%B9%88%E5%81%9A"><span class="toc-number">3.</span> <span class="toc-text">怎么做</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E8%BF%87%E7%A8%8B"><span class="toc-number">3.1.</span> <span class="toc-text">学习过程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#demo1%E7%A8%8B%E5%BA%8F%E8%AE%B2%E8%A7%A3"><span class="toc-number">4.</span> <span class="toc-text">demo1程序讲解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%8D%E4%BD%BF%E7%94%A8pug%E6%A8%A1%E6%9D%BF"><span class="toc-number">4.1.</span> <span class="toc-text">不使用pug模板</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E4%B8%80%E4%B8%AAdemo"><span class="toc-number">5.</span> <span class="toc-text">下一个demo</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FAQ"><span class="toc-number">6.</span> <span class="toc-text">FAQ</span></a></li></ol></div></div><div class="post-content"><p>&emsp;大家尽量使用chrome浏览器，其它浏览器可能会出现问题。（比如说IE内核的浏览器不支持ES6。）<br>&emsp;搭建一个最简单的物联网项目：通过手机控制LED灯开关。<br>&emsp;从程序上来讲，nodemcu（TCP客户端）与TCP服务器通信，手机浏览器（HTTP客户端）与HTTP服务器通信，最终实现通过网页控制nodemcu的LED。<br><img src="../../blog_images/005BIQVbgy1fwstl5y6srj30il0950tp.jpg" alt="demo1示例"></p>
<p>&emsp;搞物联网，首先要懂网，属于最重要的基础知识：网络相关有三节教程：<a href="/blog/posts/37707/">计算机网络基础</a>、<a href="/blog/posts/37286/">IP协议基础</a>、<a href="/blog/posts/19508/">TCP协议基础</a>。当然，要搞东西并不需要完成理解100%才动手，一般开始只需要快速浏览大概留个印象即可，暂时我们只要明白几个知识点：</p>
<ul>
<li>IP地址：代表一个设备在网络中的地址</li>
<li>端口号：代表设备上某个正在运行的程序</li>
<li>两台设备之间的网络通信：代表着两个（IP地址+端口）在通信</li>
<li>客户-服务器模型（client-server model）</li>
</ul>
<p>&emsp;从IP地址与端口号的角度来看，三台设备之间通信（这里IP地址与端口是随意配的以作演示），示意是这样的：<br><img src="../../blog_images/005BIQVbgy1fwtxx9phabj30jk095jse.jpg" alt="demo1通信示意"></p>
<h2 id="先跑起来"><a href="#先跑起来" class="headerlink" title="先跑起来"></a>先跑起来</h2><p>&emsp;首先你手上先有一块nodemcu（淘宝价十几块），按<a href="/blog/posts/31494">nodemcu基础</a>先跑那几个例程，熟悉并保证硬件上没有问题。&emsp;淘宝价大约在十几块钱，如果是第一次玩硬件，自己没有USB线的话，记得还要额外买 <strong>一条线</strong> ，<a target="_blank" rel="noopener" href="https://detail.tmall.com/item.htm?id=600041066899&amp;ali_trackid=2:mm_1201120170_1732850399_110448050250:1594048693_133_171839331&amp;spm=a21wq.12726013.1000.1&amp;scm=20140618.1.01010001.s101c6&amp;ut_sk=1.utdid_null_1594048672862.TaoPassword-Outside.lianmeng-app">淘宝链接</a>：</p>
<p><img alt="淘宝nodemcu" src="../../blog_images/005BIQVbgy1fyy8y8neuij30rw0dbtfj.jpg" style="cursor:pointer;" onclick="window.open('https://detail.tmall.com/item.htm?id=600041066899&ali_trackid=2:mm_1201120170_1732850399_110448050250:1594048693_133_171839331&spm=a21wq.12726013.1000.1&scm=20140618.1.01010001.s101c6&ut_sk=1.utdid_null_1594048672862.TaoPassword-Outside.lianmeng-app')"></p>
<p>&emsp;服务器与界面我已经写好了，并部署到我的服务器上（后面会演示怎么在你本地部署），具体代码自行查看demo1代码。demo1尽量追求简单入门，所以界面不好看，性能也不足，后面会讨论如何优化。整个demo1完成后，你就会对整个物联网的项目有个基本的认识，可以大大地讨论哪个环节需要怎么开发，跟别人吹水一点都不虚。</p>
<ul>
<li>网址：<a target="_blank" rel="noopener" href="http://42.192.168.165:8001/">http://42.192.168.165:8001/</a></li>
<li>TCP服务器：42.192.168.165:9002</li>
</ul>
<iframe src="//player.bilibili.com/player.html?bvid=BV1hv411L7j3&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" class="bilibili-video"> </iframe>

<p>&emsp;如果你才下单刚买nodemcu还没到手，可以先粗略快速地浏览一下其它教程，在没有硬件的情况下都可以先学习，特别是网络知识部分。demo1流程图：</p>
<p><img src="../../blog_images/005BIQVbgy1fx3yhijxgkj30fb0b7aa6.jpg" alt="demo1流程图"></p>
<p>&emsp;当然，如果你说不想买硬件，想通过直接通过软件模拟，看看效果，也是可以的。只需要用网络调试助手<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1XBpeUK9QcA0r90yZkIe6fg">（百度网盘下载）</a>，连接到demo1服务器端，连接成功后发送一条字符串当作设备id，也是可以模拟出来，只是没有硬件能直接控制LED灯开关那么直观而已。<strong>大家一定要建立一种等效替换的意识，不管你手上是nodemcu还是单片机+ESP8266，还是什么其它比如4G模块、NB-IOT模块，对于服务器来说本质都是TCP客户端，没有任何区别，所以在调试时完全可以单纯地使用软件来等效替换。</strong> 在实际调试开发中，经常都需要把硬件与软件各自分开来调试，直到两者都调试正常验证正确之后，才会把软件硬件一起联调。</p>
<p><img class="lazy" alt="网络调试助手模拟demo1" data-src="../../blog_images/005BIQVbgy1fxuzdtrbasg31gy0rib2a.gif"></img></p>
<h2 id="在自己电脑上跑起来"><a href="#在自己电脑上跑起来" class="headerlink" title="在自己电脑上跑起来"></a>在自己电脑上跑起来</h2><p>&emsp;先不用急着学，让这个项目能在你手上完整地跑起来，先拥有它，能不能驾驭是另一回事。下面傻瓜式演示怎么把demo1在自己电脑上跑起来。</p>
<h3 id="获取源码"><a href="#获取源码" class="headerlink" title="获取源码"></a>获取源码</h3><p>&emsp;完整的源代码可以到<a target="_blank" rel="noopener" href="https://github.com/alwxkxk/soft-and-hard">github</a>里下载，并解压。<br><img src="../../blog_images/005BIQVbgy1fxa4jvz5xtj30ty0lvwi8.jpg" alt="获取全部源码"></p>
<h3 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h3><p>&emsp;服务器代码是用nodejs写的，所以要先安装nodejs。</p>
<ol>
<li>搜索nodejs官网</li>
<li>下载nodejs，大家下载稳定版本（LTS: Long Term Support ）。安装一直点下一步即可。<br><img src="../../blog_images/005BIQVbgy1fvbmhyji22j30xk0rn0v5.jpg" alt="下载nodejs"></li>
<li>在cmd里运行<code>node -v</code>与<code>npm -v</code>验证nodejs安装成功<br><img src="../../blog_images/005BIQVbgy1fvbmigtxlcj31hc0t4jw0.jpg" alt="验证nodejs安装成功"><h3 id="安装依赖包并运行"><a href="#安装依赖包并运行" class="headerlink" title="安装依赖包并运行"></a>安装依赖包并运行</h3>&emsp;如果你有nodejs与git的使用经验就会知道，默认的作法是只上传源码，而依赖包自行安装以减少git文件体积。注意需要进入到对应的目录，使用命令<code>npm install</code>安装依赖，<code>npm start</code>运行，可以看视频操作：</li>
</ol>
<iframe src="//player.bilibili.com/player.html?bvid=BV1rK4y1o74H&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" class="bilibili-video"> </iframe>

<p>&emsp;整个过程因为没有相关基础知识，所以并不懂，很正常，经过后面的学习就会了解整个过程。(如果执行<code>npm install</code>安装依赖库时等待很久提示安装失败，可以尝试设置由淘宝提供的<a target="_blank" rel="noopener" href="https://npm.taobao.org/">国内镜像</a>，<code>npm config set registry https://registry.npm.taobao.org</code>，验证：<code>npm config get registry</code>，如果返回<code>https://registry.npm.taobao.org</code>说明设置成功，再次尝试安装<code>npm install</code>。)<br>&emsp;<strong>特别注意，把代码部署到自己电脑上，只能够在局域网内访问，简单来讲就是电脑、硬件、手机等都必须是连在同一个WIFI里。当你使用手机换成流量模式而不是连接WIFI，你会发现网页无法访问。这是因为你电脑是没有公网IP（亦可称外网IP）的，只能在同一局域网里使用内网IP访问。要想让全世界的人都能访问到，让世界各地的硬件都能连接上，你必须要使用一台拥有公网IP的电脑，然后把这套代码部署上去。具体做法是租一台云服务器，安装linux系统，部署代码，设置安全组等等。</strong> 上面提到的demo1在线示范就是我租用了一个云服务器，并部署以供参考：</p>
<ul>
<li>HTTP服务器，网址：<a target="_blank" rel="noopener" href="http://42.192.168.165:8001/">http://42.192.168.165:8001/</a></li>
<li>TCP服务器：42.192.168.165:9002</li>
</ul>
<p>&emsp;<strong>注意区分 HTTP服务器与TCP服务器，HTTP服务器对应浏览器打开的网页，而TCP服务器对应的是硬件/网络调试助手建立TCP连接所用。</strong></p>
<p>&emsp;拥有公网IP的云服务器，本质就是一台能让世界连接上的电脑，跟你自己电脑本质差别仅仅是多了一个公网IP而已。在这台云服务器上，可以安装windows系统（不推荐）、linux系统，然后安装软件，部署代码等操作，以对外提供服务。相关教程涉：<a href="/blog/posts/34982">linux基础</a>、<a href="/blog/posts/37286">IP协议基础</a>。<strong>因为linux学习需要比较长的时间，学习起来相对困难，建议大家先把项目跑起来先，linux与云服务器放到比较后的地方再学习。</strong>。</p>
<h3 id="瞎折腾"><a href="#瞎折腾" class="headerlink" title="瞎折腾"></a>瞎折腾</h3><p>&emsp;虽然说读者可能到现在什么都不懂，但这里演示如何瞎折腾，让读者获得一下拥有感，演示一下修改网页内容：</p>
<iframe src="//player.bilibili.com/player.html?bvid=BV1GA411V7zf&page=1" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true" class="bilibili-video"> </iframe>

<h2 id="怎么做"><a href="#怎么做" class="headerlink" title="怎么做"></a>怎么做</h2><p>&emsp;具体的技术选型不再讨论，可阅读<a href="/blog/posts/44755/">软硬结合</a>，结论就是：</p>
<ul>
<li>硬件：nodemcu，使用Arduino IDE进行开发，与服务器使用TCP通信</li>
<li>服务器：Nodejs，使用express4.x框架</li>
<li>界面：HTML+CSS+JavaScript，Jquery与Bootstrap</li>
</ul>
<h3 id="学习过程"><a href="#学习过程" class="headerlink" title="学习过程"></a>学习过程</h3><ul>
<li><p><a href="/blog/posts/37707">计算机网络基础</a><br>&emsp;先了解基本的网络知识，半个小时吧。</p>
</li>
<li><p><a href="/blog/posts/31494">nodemcu基础</a><br>&emsp;了解nodemcu与开发，两三个小时吧。</p>
</li>
<li><p><a href="/blog/posts/54080">HTML、CSS、JS基础</a><br>&emsp;了解界面开发的三件套基础知识，<strong>结合其它教程自学，大约两三个星期</strong>，能做出基本的网页界面。</p>
</li>
<li><p><a href="/blog/posts/56793">nodejs基础</a><br>&emsp;了解nodejs开发、ES6语法、express框架，<strong>结合其它教程自学，大约两个星期</strong>。</p>
</li>
<li><p>学习并模仿<a href="/blog/posts/38208">demo0.1</a><br>&emsp;demo0.1是demo1的简化版，简化功能与不使用express框架，降低学习成本。</p>
</li>
<li><p><a href="/blog/posts/52429">chrome开发者工具</a><br>&emsp;学习怎么调试网页，分析别人网页，<strong>拥有分析并模仿别人的网页的能力</strong>。</p>
</li>
<li><p><a href="/blog/posts/27238">Jquery、Bootstrap基础</a><br>&emsp;学习Jquery、Bootstrap基础。<strong>并尝试模仿别人网页，检验学习成果。</strong></p>
</li>
<li><p>学习并模仿<a href="/blog/posts/64786">demo1</a><br>&emsp;尽可能地自行实现demo1效果，大约几天。</p>
</li>
<li><p><a href="/blog/posts/34982">linux基础</a><br>&emsp;为了让后端程序部署到云服务器里，你还需要学习linux基础并购买云服务器。</p>
</li>
</ul>
<h2 id="demo1程序讲解"><a href="#demo1程序讲解" class="headerlink" title="demo1程序讲解"></a>demo1程序讲解</h2><p>&emsp;demo1代码可在<a target="_blank" rel="noopener" href="https://github.com/alwxkxk/soft-and-hard">项目代码</a>的<code>/demo1/myapp</code>里找到。整个代码就是由<a target="_blank" rel="noopener" href="http://www.expressjs.com.cn/starter/generator.html">Express 手脚架</a>使用<code>express --view=pug myapp</code>一健生成的。整个程序的入口启动文件就是<code>myapp/bin/www</code>，界面的代码是<code>myapp/views/index.pug</code>，其JS代码是<code>myapp/public/javascripts/index.js</code>。同时添加了TCP服务器的代码<code>myapp/bin/tcp-server.js</code>，用于接收TCP客户端的数据。<br>&emsp;当使用硬件连接到服务器时，硬件发出的第一条数据成为其设备id，所有数据都会存放到<code>socket.lastValue</code>中。为了防止不同的读者使用同一个设备ID操作时数据串扰，所以我还额外添加了IP地址以区分。所有超过10秒没有发数据的都会删除设备。（对应代码<code>myapp/bin/tcp-server.js</code>）<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// receive data</span></span><br><span class="line">socket.on(<span class="string">&quot;data&quot;</span>,<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line"><span class="keyword">let</span> str = addr+<span class="string">&quot; receive: &quot;</span> + data.toString(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">socket.lastValue = data.toString(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(str)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// demo1中，我们定义了，接收的第一条数据为设备id</span></span><br><span class="line">  <span class="keyword">if</span>(!socket.id)&#123;</span><br><span class="line">	socket.id = data.toString(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">	socket.addr = addr</span><br><span class="line">	addEquipment(socket)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><br>&emsp;当浏览器打开网页时，发起HTTP请求（GET /），服务器代码进入到<code>myapp/routes/index.js</code>进行渲染，将已经连接到TCP服务器的设备数据都传入到模板<code>myapp/views/index.pug</code>中，渲染出对应的HTML页面再发送给浏览器进行显示。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">title</span>: <span class="string">&#x27;软硬结合demo1&#x27;</span>,<span class="attr">tcpServer</span>:tcpServer &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>&emsp;当浏览器选择某个设备，并发起开/关灯控制时，就会触发到界面的JS代码（对应<code>myapp/public/javascripts/index.js</code>），发出POST请求（POST /）：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 点击按钮事件</span></span><br><span class="line">$(<span class="string">&quot;#open&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> equipment = getEquipmentInfo()</span><br><span class="line">  $.post(<span class="string">&quot;/&quot;</span>, &#123; <span class="attr">action</span>:<span class="string">&quot;open&quot;</span>,<span class="attr">addr</span>: equipment.addr, <span class="attr">id</span>: equipment.id &#125; );</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">$(<span class="string">&quot;#close&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> equipment = getEquipmentInfo()</span><br><span class="line">  $.post(<span class="string">&quot;/&quot;</span>, &#123; <span class="attr">action</span>:<span class="string">&quot;close&quot;</span>,<span class="attr">addr</span>: equipment.addr, <span class="attr">id</span>: equipment.id &#125; );</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>&emsp;浏览器发出POST请求后，由服务器端代码<code>myapp/routes/index.js</code>进行处理，找到对应的设备，并发送控制命令，此时硬件接收到命令进行开关灯。<code>req.body.addr，req.body.id，req.body.action</code>这些数据就是来源于上面的代码，前端点击按钮后向后端发送的数据：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// POST / 控制设备开关灯</span></span><br><span class="line">router.post(<span class="string">&#x27;/&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// req.body.addr，req.body.id，req.body.action这些是来源于上面刚提到的前端代码</span></span><br><span class="line">  <span class="keyword">let</span> addr = req.body.addr</span><br><span class="line">  <span class="keyword">let</span> id = req.body.id</span><br><span class="line">  <span class="keyword">let</span> action = req.body.action</span><br><span class="line">  <span class="keyword">if</span>(action === <span class="string">&#x27;open&#x27;</span> || action === <span class="string">&#x27;close&#x27;</span>)&#123;</span><br><span class="line">    tcpServer.sentCommand(id,addr,action)</span><br><span class="line">  &#125;</span><br><span class="line">  res.json(req.body);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="不使用pug模板"><a href="#不使用pug模板" class="headerlink" title="不使用pug模板"></a>不使用pug模板</h3><p>&emsp;pug模板以前叫做jade，可能搜索pug相关内容较少，可以搜索jade进行学习。在撑握html基础知识的前提下，学习使用pug模板不过是几个小时的事，十分简单。但毕竟是入门教程，理应引入较少的内容让新手尽快做出效果，以进入正循环，所以在demo1中还提供了不使用pug模板，直接使用html的做法。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// demo1/myapp/routes/index.js</span></span><br><span class="line"><span class="comment">// GET /no-pug-index 不使用pug模板，直接发送html文件</span></span><br><span class="line">router.get(<span class="string">&#x27;/no-pug-index&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//root 传入文件所在的目录路径</span></span><br><span class="line">  res.sendFile(<span class="string">&#x27;no-pug-index.html&#x27;</span>,&#123;<span class="attr">root</span>:<span class="string">&quot;views&quot;</span>&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><br>&emsp;大家可以访问<code>/no-pug-index</code>即可看到效果。在demo1中，pug模板的作用是将后台的数据渲染（render）成html文件。而一旦使用html文件，要么自己通过JS代码根据数据拼装成html文件再发送（本质上pug模板的作用就是简化这个拼接过程），要么发送一份不包含数据的html文件，由前端向后端再进行请求数据进而把数据写入到页面当中（有点前后端分离的味道）。这里我演示了第二种做法。<br>&emsp;大家看<code>demo1/myapp/views/no-pug-index.html</code>这个html文件，除了不包含数据其它内容基本与<code>index.pug</code>一致（pug语法更为简洁）。<code>no-pug-index.html</code>所引用的JS文件<code>demo1/myapp/public/javascripts/no-pug-index.js</code>，相对于<code>index.js</code>也仅仅是多了请求后台数据并写入到html文件的代码：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$.get(<span class="string">&quot;/equipmentArray&quot;</span>,<span class="function">(<span class="params">res</span>)=&gt;</span>&#123;</span><br><span class="line">  res.forEach(<span class="function"><span class="params">equipment</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//将设备数据转换成html元素添加到页面中</span></span><br><span class="line">    <span class="comment">//添加到选项中</span></span><br><span class="line">    $(<span class="string">&#x27;select&#x27;</span>).append(<span class="string">&#x27;&lt;option&gt;&#x27;</span>+equipment.addr+<span class="string">&#x27; - &#x27;</span>+equipment.id+<span class="string">&#x27;&lt;/option&gt;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加到列表中</span></span><br><span class="line">    $(<span class="string">&#x27;table&#x27;</span>).append(<span class="string">&#x27;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;0&lt;/td&gt;&lt;td&gt;&#x27;</span>+equipment.addr+</span><br><span class="line">    <span class="string">&#x27;&lt;/td&gt;&lt;td&gt;&#x27;</span>+equipment.id+<span class="string">&#x27; &lt;/td&gt;&lt;td style=&quot;overflow: hidden;&quot;&gt;&#x27;</span>+equipment.lastValue||<span class="string">&#x27;无&#x27;</span>+<span class="string">&#x27;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&#x27;</span>)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h2 id="下一个demo"><a href="#下一个demo" class="headerlink" title="下一个demo"></a>下一个demo</h2><p>&emsp;demo1尽量追求简单入门，所以界面不好看（帅是第一生产力），性能也不足。先说说demo1的问题：</p>
<ul>
<li>每次刷新页面才会显示最新的tick值。（讨论HTTP轮询以及引入websocket协议）</li>
<li>界面丑（优化并会引入图表库Echart，实现数据可视化）</li>
<li>不能显示历史数据（引入数据库）<br>&emsp;在实现下一个demo之前会讨论解决以上问题，之后会做出一个能看能用的demo，同时会介绍其它技术。</li>
</ul>
<h2 id="FAQ"><a href="#FAQ" class="headerlink" title="FAQ"></a>FAQ</h2><ol>
<li><p>为什么我点击按钮没能控制LED灯亮灭？<br><strong>答：原因一：使用了错误的浏览器，可打开开发者调试工具查看是否有报错，IE浏览器，360浏览器内核太旧无法支持新版的JQuery而报错，大家请改用chrome浏览器。原因二：nodemcu可能是V3版本需要定义引脚，或者硬件异常，请到<a href="/blog/posts/31494">nodemcu基础</a>跑第一个例程，让LED灯一直闪烁确保硬件正常再跑demo1。</strong></p>
</li>
<li><p>把项目部署到云服务器linux中，但把SSH一关网站就访问不了了，怎么才能一直打开?<br><strong>答：学习 nodejs部署工具 PM2，可以让程序一直跑着。另外在linux系统里关闭SSH后，系统会给这个pty所关联的session中的所有进程发送SIGHUP信号，SIGHUP的默认信号处理程序是终止进程，除非进程自己处理了 SIGHUP。可以学习并使用linux 命令 <code>screen</code> ，解决这个问题。</strong></p>
</li>
<li><p>如何使ESP8266与手机不在同一局域网也能通信?<br><strong>答：这就需要把后端程序部署到云服务器。</strong></p>
</li>
<li><p>将服务部署到云服务器后，硬件/网关如何上传数据？<br><strong>答：本质上是一样的，在自己电脑部署时硬件通过IP地址给电脑传输数据，这个IP地址是内网的。而部署到云服务器，就拥有外网IP地址，只要硬件/网关能访问外网（WIFI、4G等）一样能给外网传略数据。云服务器注意配置安全组与防火墙开放端口，具体知识请学习<a href="/blog/posts/37707">网络知识</a>与<a href="/blog/posts/34982">Linux知识</a>。</strong></p>
</li>
<li><p><code>npm install</code> 安装依赖库等了很久，没成功安装，怎么办？<br><strong>答：如果执行<code>npm install</code>安装依赖库时等待很久提示安装失败，可以尝试设置由淘宝提供的<a target="_blank" rel="noopener" href="https://npm.taobao.org/">国内镜像</a>，<code>npm config set registry https://registry.npm.taobao.org</code>，验证：<code>npm config get registry</code>，如果返回<code>https://registry.npm.taobao.org</code>说明设置成功，再次尝试安装<code>npm install</code>。</strong></p>
</li>
<li><p>请问这个demo1是前后端分离的吗？<br><strong>答：不是。前后端分离可以理解为 一个静态网页作为前端展示+ 一个只提供数据的后端，浏览器先加载出静态页面，然后通过HTTP请求向后端拿数据并展示。这样做的最大特点就是：前端与后端可以分别部署到两台不同的服务器上（当然也可以部署到同一台），这样有利于优化。而这个demo1，网页是先在后端拼出HTML（pug模板渲染的作用），再发送到浏览器显示，所以不能分开部署，不属于前后端分离的项目。</strong></p>
</li>
<li><p>为什么我本地运行的demo1没有看到我的设备，但在博主的demo1示例网站上能看到我的设备？<br><strong>答：根本原因是你的设备“没有连接到你本地电脑的demo1，而是连接到我云服务器上的demo1。”，请检查硬件代码是否连接到你本地的demo1。（保证在同一网络之中，这样硬件才能连接到你本地的demo1。）</strong></p>
</li>
<li><p>我自己创建的项目，运行<code>npm run start</code>时报错<code>ENOENT: no such file or directory, open &#39;...\package.json&#39;</code><br><strong>答：实现认真看一下报错信息就容易看到哪里出问题了，这报错就是说无法打开<code>package.json</code>文件。如果有学node.js就知道，<code>npm run start</code>其实是根据<code>package.json</code>里配置的来执行对应的命令。</strong></p>
</li>
</ol>
</div><h1>打赏支持</h1><p style="font-size: 24px;text-indent: 2em;">请博主喝个饮料：</p><div style="display:flex;justify-content: space-around;"><img src="../../img/AliPayQR.png" alt="" srcset="" style="width:340px;"><img src="../../img/WeChatQR.png" alt="" srcset="" style="width:340px;"></div><div class="tags"><a href="/blog/tags/IOT/">IOT</a></div><div id="vcomment"></div><script src="/blog/js/av-min.js"></script><script src="/blog/js/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'dibwgE5SQgKyFS1KqM3C2WmQ-gzGzoHsz',
  appKey:'G24uL9Fw9oNCfheBorc3GjVB',
  placeholder:'欢迎留言交流',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer">Copyright © 2021 <a href="/blog/." rel="nofollow">生子当如哈士奇的个人博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><script type="text/javascript" src="/blog/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/blog/js/smartresize.js?v=0.0.0"></script><script type="text/javascript" src="/blog/js/index.js"></script></header></main><script src="/blog/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/blog/live2dw/assets/hijiki.model.json"},"log":false});</script></body></html>